# ν”„λ΅μ νΈλ…: Lattigo-Wasm FHE μ›Ή μ• ν”λ¦¬μΌ€μ΄μ… PoC

**λ¬Έμ„ λ²„μ „:** 1.0
**μ‘μ„±μΌ:** 2025λ…„ 10μ›” 31μΌ

## 1. π€ ν”„λ΅μ νΈ κ°μ”

### 1.1. ν”„λ΅μ νΈ λ©ν‘
λ³Έ ν”„λ΅μ νΈμ λ©ν‘λ” Go(Golang) κΈ°λ°μ FHE λΌμ΄λΈλ¬λ¦¬μΈ **Lattigo**λ¥Ό **WebAssembly(Wasm)**λ΅ μ»΄νμΌν•κ³ , **React** μ›Ή ν”„λ΅ νΈμ—”λ“μ™€ μ—°λ™ν•μ—¬ **ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“(Client-Side)μ—μ„ FHE ν‚¤ κ΄€λ¦¬ λ° μ•”λ³µνΈν™”λ¥Ό μν–‰**ν•λ” E2E(End-to-End) μ„λΉ„μ¤μ PoC(Proof-of-Concept)λ¥Ό κµ¬μ¶•ν•λ” κ²ƒμ…λ‹λ‹¤.

μ„λ²„λ” μ‚¬μ©μμ λΉ„λ°€ ν‚¤($sk$)μ— μ λ€ μ ‘κ·Όν•μ§€ μ•μΌλ©°, μ¤μ§ λ™ν• μ—°μ‚°(Computation)λ§μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤.

### 1.2. ν•µμ‹¬ μ‚¬μ© μ‚¬λ΅€ (μμ‹: ν”„λΌμ΄λΉ— ν†µκ³„)
* **μ‹λ‚λ¦¬μ¤:** "λ―Όκ°ν• κ±΄κ°• μ •λ³΄(μ: μΌμΌ κ±Έμ μ)μ ν”„λΌμ΄λΉ— ν‰κ·  κ³„μ‚°"
1.  **μ‚¬μ©μ (Client):** μμ‹ μ 'κ±Έμ μ'(μ: `7500`)λ¥Ό μ…λ ¥ν•©λ‹λ‹¤.
2.  **Client (Wasm):** λΈλΌμ°μ € λ‚΄μ—μ„ Lattigo Wasm λ¨λ“μ„ μ‚¬μ©ν•΄ `7500`μ„ μ•”νΈν™”ν•©λ‹λ‹¤.
3.  **Client -> Server:** μ•”νΈλ¬Έ($ct$)μ„ μ„λ²„λ΅ μ „μ†΅ν•©λ‹λ‹¤.
4.  **Server:** λ‹¤λ¥Έ μ‚¬μ©μλ“¤μ μ•”νΈλ¬Έλ“¤κ³Ό ν•©μ‚°($Add$)ν•κ³ , μ΄μΈμ›μΌλ΅ λ‚λ„μ–΄($DivByPlain$) 'ν‰κ·  κ±Έμ μ μ•”νΈλ¬Έ'($ct_{avg}$)μ„ κ³„μ‚°ν•©λ‹λ‹¤.
5.  **Server -> Client:** $ct_{avg}$λ¥Ό ν΄λΌμ΄μ–ΈνΈλ΅ λ°ν™ν•©λ‹λ‹¤.
6.  **Client (Wasm):** λΈλΌμ°μ € λ‚΄μ—μ„ $ct_{avg}$λ¥Ό λ³µνΈν™”ν•μ—¬ "μ „μ²΄ μ‚¬μ©μ ν‰κ·  κ±Έμ μ: 6800"μ΄λΌλ” κ²°κ³Όλ¥Ό ν™•μΈν•©λ‹λ‹¤.
* **λ³΄μ•:** μ„λ²„λ” `7500`μ΄λΌλ” ν‰λ¬Έμ€ λ¬Όλ΅ , κ°λ³„ μ‚¬μ©μμ $sk$λ„ μ•μ§€ λ»ν•©λ‹λ‹¤.

### 1.3. κΈ°μ  μ¤νƒ
* **FHE λΌμ΄λΈλ¬λ¦¬:** **Lattigo** (Go) - CKKS μ¤ν‚΄ ν™μ©
* **Wasm μ»΄νμΌ:** **Go 1.x** (`GOOS=js GOARCH=wasm`)
* **ν”„λ΅ νΈμ—”λ“:** **React.js** (Hooks, Context API)
* **λ°±μ—”λ“ (API μ„λ²„):** **Go** (`net/http` λλ” `Gin`)
* **ν΄λΌμ΄μ–ΈνΈ λ³΄μ•:** **Web Cryptography API** (`crypto.subtle`), **IndexedDB**

---

## 2. π›οΈ μ‹μ¤ν… μ•„ν‚¤ν…μ²



1.  **Client (React App):**
    * `main.wasm` (Lattigo μ»΄νμΌλ³Έ)κ³Ό `wasm_exec.js` λ΅λ“.
    * μ‚¬μ©μ λ΅κ·ΈμΈ/νμ›κ°€μ… μ‹ **λΉ„λ°€λ²νΈ** μ…λ ¥.
    * **Web Crypto API**λ΅ λΉ„λ°€λ²νΈμ—μ„ AES ν‚¤ μ λ„.
2.  **Client (Wasm):**
    * `KeyGen()` νΈμ¶: FHE ν‚¤ μ($pk$, $sk$) μƒμ„±.
    * $sk$λ” AES ν‚¤λ΅ μ•”νΈν™”λμ–΄ `IndexedDB`μ— μ €μ¥.
    * $pk$λ” ν‰λ¬ΈμΌλ΅ μ„λ²„μ— μ „μ†΅ (DB μ €μ¥μ©).
3.  **Client (Wasm):**
    * λ°μ΄ν„° μ•”νΈν™” μ‹ `IndexedDB`μ—μ„ μ•”νΈν™”λ $sk$ λ΅λ“.
    * λΉ„λ°€λ²νΈ μ¬μ…λ ¥λ°›μ•„ AES ν‚¤λ΅ $sk$ λ³µνΈν™” (λ©”λ¨λ¦¬μƒμ—μ„λ§).
    * `Encrypt(data, pk)` μ‹¤ν–‰.
4.  **Client -> Server:**
    * `POST /compute` APIλ΅ μ•”νΈλ¬Έ($ct$) μ „μ†΅.
5.  **Server (Go Backend):**
    * `ct` μμ‹ .
    * μ €μ¥λ $pk$μ™€ Lattigo λΌμ΄λΈλ¬λ¦¬(λ„¤μ΄ν‹°λΈ Go)λ¥Ό μ‚¬μ©ν•΄ FHE μ—°μ‚° μν–‰.
    * κ²°κ³Ό μ•”νΈλ¬Έ($ct_{result}$) μƒμ„±.
6.  **Server -> Client:**
    * $ct_{result}$ λ°ν™.
7.  **Client (Wasm):**
    * (3)λ²κ³Ό λ™μΌν•κ² $sk$λ¥Ό λ©”λ¨λ¦¬μ— λ΅λ“.
    * `Decrypt(ct_result, sk)` μ‹¤ν–‰.
    * ν‰λ¬Έ κ²°κ³Όλ¥Ό ν™”λ©΄μ— λ λ”λ§.
    * λ©”λ¨λ¦¬μ—μ„ $sk$ μ¦‰μ‹ νκΈ°.

---

## 3. π“¦ ν”„λ΅μ νΈ λ§μΌμ¤ν†¤ (λ‹¨κ³„λ³„ κµ¬ν„ κ³„ν)

### Phase 1: Go (Lattigo) Wasm λ¨λ“ κ°λ°
* **λ©ν‘:** Lattigoμ ν•µμ‹¬ κΈ°λ¥(KeyGen, Encrypt, Decrypt)μ„ WasmμΌλ΅ μ»΄νμΌν•κ³  JSμ—μ„ νΈμ¶ κ°€λ¥ν• ν•νƒλ΅ λ…Έμ¶.
* **μ£Όμ” μ‘μ—…:**
    1.  `main.go` νμΌ μ‘μ„±.
    2.  Lattigoμ `ckks.Parameters` μ •μ (ν•λ“μ½”λ”©).
    3.  **`syscall/js`**λ¥Ό μ‚¬μ©ν•μ—¬ Go ν•¨μλ¥Ό JavaScript μ „μ—­ κ°μ²΄μ— λ“±λ΅.
        * `js.Global().Set("fheKeygen", js.FuncOf(keygenWrapper))`
    4.  **Wrapper ν•¨μ μ‘μ„±:** JSμ `Uint8Array`λ‚ `string`μ„ Goμ `[]byte`λ΅ λ³€ν™ν•κ³ , Lattigo κ°μ²΄λ¥Ό `[]byte` (μ§λ ¬ν™”)λ΅ λ³€ν™ν•μ—¬ λ°ν™.
        * `keygenWrapper()`: $pk$, $sk$λ¥Ό `[]byte`λ΅ μ§λ ¬ν™”ν•μ—¬ λ°ν™.
        * `encryptWrapper()`: $pk$(`[]byte`), $plaintext$(`float64`)λ¥Ό λ°›μ•„ $ciphertext$(`[]byte`) λ°ν™.
        * `decryptWrapper()`: $sk$(`[]byte`), $ciphertext$(`[]byte`)λ¥Ό λ°›μ•„ $plaintext$(`float64`) λ°ν™.
    5.  `GOOS=js GOARCH=wasm go build -o main.wasm main.go` λ…λ Ήμ–΄λ΅ Wasm λΉλ“.

### Phase 2: React ν”„λ΅ νΈμ—”λ“ λ° $sk$ λ³΄μ• μ¤ν† λ¦¬μ§€ κµ¬μ¶•
* **λ©ν‘:** Wasm λ¨λ“μ„ λ΅λ“ν•κ³ , Web Crypto APIλ¥Ό μ‚¬μ©ν•΄ $sk$λ¥Ό μ•μ „ν•κ² `IndexedDB`μ— μ €μ¥ν•λ” λ΅μ§ κµ¬ν„.
* **μ£Όμ” μ‘μ—…:**
    1.  React ν”„λ΅μ νΈ μƒμ„± (`create-react-app`).
    2.  `public/` ν΄λ”μ— `main.wasm`κ³Ό `wasm_exec.js` λ³µμ‚¬.
    3.  `FheService.js` (React Context λλ” μ „μ—­ λ¨λ“) μƒμ„±:
        * Wasm λ¨λ“ λΉ„λ™κΈ° λ΅λ“ λ° μ΄κΈ°ν™” λ΅μ§.
        * `Web Crypto API`λ¥Ό μ‚¬μ©ν• $sk$ μ•”λ³µνΈν™” λνΌ ν•¨μ κµ¬ν„ (PBKDF2 + AES-GCM).
        * `IndexedDB` ν—¬νΌ ν•¨μ κµ¬ν„ (`saveKey`, `loadKey`).
    4.  UI μ»΄ν¬λ„νΈ κ°λ°:
        * `KeygenButton`: `fheKeygen()` νΈμ¶, $pk$λ” (μ½μ†” μ¶λ ¥), μ•”νΈν™”λ $sk$λ” `IndexedDB` μ €μ¥.
        * `EncryptInput`: μ«μ μ…λ ¥ -> `encryptWrapper()` νΈμ¶ -> μ•”νΈλ¬Έ(string) ν‘μ‹.
        * `DecryptButton`: μ•”νΈλ¬Έ(string) μ…λ ¥ -> `decryptWrapper()` νΈμ¶ -> ν‰λ¬Έ ν‘μ‹.

### Phase 3: Go λ°±μ—”λ“ API μ„λ²„ κ°λ°
* **λ©ν‘:** FHE μ—°μ‚°μ„ μν–‰ν•λ” κ°„λ‹¨ν• API μ„λ²„ κµ¬μ¶•.
* **μ£Όμ” μ‘μ—…:**
    1.  `Gin` λλ” `net/http`λ¥Ό μ‚¬μ©ν• API μ„λ²„ κµ¬μ¶•.
    2.  Lattigo λΌμ΄λΈλ¬λ¦¬ import (λ„¤μ΄ν‹°λΈ Go).
    3.  (μ„μ‹) $pk$λ¥Ό λ©”λ¨λ¦¬λ‚ νμΌμ—μ„ λ΅λ“ν•λ” λ΅μ§.
    4.  `POST /compute` μ—”λ“ν¬μΈνΈ κµ¬ν„:
        * Clientλ΅λ¶€ν„° $ct$(`[]byte`) μμ‹ .
        * Lattigo κ°μ²΄λ΅ μ—­μ§λ ¬ν™”.
        * λ―Έλ¦¬ μ •μλ FHE μ—°μ‚° μν–‰ (μ: `evaluator.AddConst()`, `evaluator.MultByConst()` λ“±).
        * κ²°κ³Ό $ct_{result}$λ¥Ό `[]byte`λ΅ μ§λ ¬ν™”ν•μ—¬ JSONμΌλ΅ λ°ν™.

### Phase 4: E2E ν†µν•© λ° ν…μ¤νΈ
* **λ©ν‘:** 1~3λ‹¨κ³„μ λ¨λ“μ„ ν†µν•©ν•μ—¬ "ν”„λΌμ΄λΉ— ν†µκ³„" μ‹λ‚λ¦¬μ¤ μ „μ²΄ ν”λ΅μ° ν…μ¤νΈ.
* **μ£Όμ” μ‘μ—…:**
    1.  React μ•±μ—μ„ `fetch` λλ” `axios`λ¥Ό μ‚¬μ©ν•μ—¬ λ°±μ—”λ“ `/compute` API νΈμ¶.
    2.  E2E μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ: (Client Enc) -> (Server Compute) -> (Client Dec).
    3.  μ¤λ¥ μ²λ¦¬ λ° λ΅κΉ… (Wasm/Go μ¤λ¥κ°€ Reactλ΅ μ μ „λ‹¬λλ”μ§€ ν™•μΈ).

---

## 4. π”’ ν•µμ‹¬ λ³΄μ• κ°€μ΄λ“λΌμΈ (Security Guidelines)

**κ°€μ¥ μ¤‘μ”ν• λ¶€λ¶„μ€ $sk$μ ν΄λΌμ΄μ–ΈνΈ μΈ΅ κ΄€λ¦¬μ…λ‹λ‹¤.**

1.  **$sk$ μ €μ¥μ† (Storage):**
    * **μ λ€ κΈμ§€:** `localStorage`, `sessionStorage`, `Cookie`. (XSS κ³µκ²© μ‹ ν‰λ¬Έ λ…Έμ¶)
    * **κ¶μ¥:** **`IndexedDB`** (λ€μ©λ‰ $sk$ μ €μ¥ κ°€λ¥, Same-Origin Policy).
2.  **$sk$ μ•”νΈν™” (Encryption at Rest):**
    * `IndexedDB`μ— $sk$ ν‰λ¬Έμ„ **μ λ€** μ €μ¥ν•λ©΄ μ• λ©λ‹λ‹¤.
    * λ°λ“μ‹ **Web Cryptography API**λ¥Ό μ‚¬μ©ν•μ—¬ μ‚¬μ©μμ λΉ„λ°€λ²νΈλ΅λ¶€ν„° μ λ„λ ν‚¤(AES-GCM)λ΅ $sk$λ¥Ό μ•”νΈν™”ν•μ—¬ μ €μ¥ν•΄μ•Ό ν•©λ‹λ‹¤. (μ΄μ „ λ€ν™”μ 'Better' λ°©μ‹)
    * `PBKDF2` (Salt μ‚¬μ©, λ†’μ€ Iteration)λ΅ λΉ„λ°€λ²νΈμ—μ„ AES ν‚¤ μ λ„.
3.  **$sk$ μΈλ©”λ¨λ¦¬ κ΄€λ¦¬ (In-Memory Policy):**
    * ν‰λ¬Έ $sk$λ” **μ¤μ§ `decrypt()` ν•¨μ νΈμ¶ μ§μ „μ—λ§** λ©”λ¨λ¦¬μ— μ΅΄μ¬ν•΄μ•Ό ν•©λ‹λ‹¤.
    * Wasm λ¨λ“(`myWasmModule.decrypt`) νΈμ¶μ΄ μ™„λ£(μ„±κ³µ/μ‹¤ν¨)λλ©΄, JavaScript λ³€μμ— ν• λ‹Ήλ ν‰λ¬Έ $sk$λ¥Ό μ¦‰μ‹ `null`λ΅ λ®μ–΄μ“°κ±°λ‚ λ²”μ„λ¥Ό λ²—μ–΄λ‚κ² ν•μ—¬ GC(κ°€λΉ„μ§€ μ»¬λ ‰μ…) λ€μƒμΌλ΅ λ§λ“¤μ–΄μ•Ό ν•©λ‹λ‹¤.
    * μ‚¬μ©μκ°€ μΌμ • μ‹κ°„ μλ¦¬λ¥Ό λΉ„μ°λ©΄(Idle-timeout) λ©”λ¨λ¦¬μƒμ $sk$λ¥Ό μλ™μΌλ΅ νκΈ°ν•κ³  μ¬μΈμ¦(λΉ„λ°€λ²νΈ μ…λ ¥)μ„ μ”κµ¬ν•΄μ•Ό ν•©λ‹λ‹¤.
4.  **Wasm μΈν„°νμ΄μ¤ λ³΄μ•:**
    * Go Wasm λ¨λ“μ ν•¨μλ” **μ§λ ¬ν™”λ `[]byte`** (λλ” Base64 String)λ§μ„ μ…μ¶λ ¥μΌλ΅ λ°›μ•„μ•Ό ν•©λ‹λ‹¤. Lattigoμ λ‚΄λ¶€ κ°μ²΄ ν¬μΈν„°λ¥Ό JSλ΅ λ…Έμ¶ν•λ©΄ μ• λ©λ‹λ‹¤.
5.  **μ„λ²„ ν†µμ‹  λ³΄μ•:**
    * **μ „μ†΅ κ³„μΈµ μ•”νΈν™”:** λ¨λ“  Client-Server ν†µμ‹ μ€ **HTTPS**λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•©λ‹λ‹¤.
        * **HTTPS vs TLS μ„ νƒ κ·Όκ±°:**
            * **HTTPS (HTTP over TLS)** μ±„νƒ: μ›Ή μ• ν”λ¦¬μΌ€μ΄μ… νΉμ„±μƒ HTTPSκ°€ μµμ μ…λ‹λ‹¤.
            * TLSλ” μ „μ†΅ κ³„μΈµ μ•”νΈν™” ν”„λ΅ν† μ½ μμ²΄μ΄λ©°, HTTPSλ” TLS μ„μ—μ„ λ™μ‘ν•λ” μ• ν”λ¦¬μΌ€μ΄μ… κ³„μΈµ ν”„λ΅ν† μ½μ…λ‹λ‹¤.
            * **HTTPS μ¥μ :** λ¨λ“  λΈλΌμ°μ € ν‘μ¤€ μ§€μ›, μΈμ¦μ„ κ΄€λ¦¬ μ—μ½”μ‹μ¤ν… μ™„μ„±(Let's Encrypt), RESTful API νΈν™, κ°λ°/λ””λ²„κΉ… μ©μ΄.
            * **Raw TLS λ‹¨μ :** λΈλΌμ°μ €μ—μ„ μ§μ ‘ μ‚¬μ© λ¶κ°€, κµ¬ν„ λ³µμ΅λ„ λ†’μ, μ»¤μ¤ν…€ ν”„λ΅ν† μ½ ν•„μ”.
        * **κµ¬ν„:** Go `net/http` μ„λ²„μ—μ„ `ListenAndServeTLS()` μ‚¬μ©, React μ•±μ€ `https://` URLλ΅ `fetch()` API νΈμ¶.
        * **κ°λ° ν™κ²½:** λ΅μ»¬ ν…μ¤νΈ μ‹ μμ²΄ μ„λ… μΈμ¦μ„(Self-signed Certificate) μ‚¬μ© κ°€λ¥. ν”„λ΅λ•μ…μ—μ„λ” Let's Encrypt λ“± μ‹ λΆ°λ CA μΈμ¦μ„ μ‚¬μ©.
    * **μ•”νΈλ¬Έ κ²€μ¦:**
        * μ„λ²„λ” $ct$ (μ•”νΈλ¬Έ) μμ‹  μ‹, μ—­μ§λ ¬ν™” κ³Όμ •μ—μ„ λ°μƒν•  μ μλ” μ¤λ¥(μ: μ•…μμ μΈ λ°”μ΄νΈμ—΄)μ— λ€ν• μμ™Έ μ²λ¦¬λ¥Ό μ² μ €ν ν•΄μ•Ό ν•©λ‹λ‹¤.
        * μ•”νΈλ¬Έ ν¬κΈ° μ ν•, νƒ€μ… κ²€μ¦, Lattigo μ—­μ§λ ¬ν™” μ—λ¬ ν•Έλ“¤λ§ ν•„μ.

---

## 5. π› οΈ κ°λ° λ° λΉλ“ ν™κ²½

### 5.1. Wasm λ¨λ“ λΉλ“ (Go)
1.  Go μ„¤μΉ ν™•μΈ (`go version`).
2.  Lattigo λ¨λ“ μ„¤μΉ (``)
3.  `main.go` (Wasm λνΌ) μ‘μ„±.
4.  `wasm_exec.js` λ³µμ‚¬:
    * `cp $(go env GOROOT)/misc/wasm/wasm_exec.js ./frontend/public/`
5.  Wasm μ»΄νμΌ:
    * `GOOS=js GOARCH=wasm go build -o ./frontend/public/main.wasm main.go`

### 5.2. React μ•± μ‹¤ν–‰
1.  `frontend` ν΄λ”μ—μ„ `npm install`
2.  `npm start`

### 5.3. Go λ°±μ—”λ“ μ‹¤ν–‰
1.  `backend` ν΄λ”μ—μ„ `go mod tidy`
2.  `go run main.go`

---

## 6. β οΈ CKKS μ¤ν‚΄ μ—°μ‚° μ‹ μ£Όμμ‚¬ν•­ (Critical for Accuracy)

### 6.1. Rescalingμ ν•„μμ„±
**CKKSλ” κ·Όμ‚¬(Approximate) λ™ν•μ•”νΈ**μ΄λ―€λ΅, κ³±μ… μ—°μ‚° ν›„ **λ°λ“μ‹ Rescalingμ„ μν–‰**ν•΄μ•Ό ν•©λ‹λ‹¤.

* **λ¬Έμ :** κ³±μ… μν–‰ μ‹ μ¤μΌ€μΌμ΄ μ κ³±λ¨ ($scale^2$)
    * μ: $ct_1 \times ct_2$ β†’ κ²°κ³Ό μ¤μΌ€μΌ = $(2^{40})^2 = 2^{80}$
    * μ΄ μƒνƒλ΅ λ³µνΈν™”ν•λ©΄ **μ‹¤μ  κ°’λ³΄λ‹¤ $2^{40}$λ°° ν° κ°’**μ΄ λ‚μ΄ (μλ°±~μμ²λ°° μ¤μ°¨ λ°μƒ)
    
* **ν•΄κ²°:** `evaluator.Rescale(ctMul, ctMul)` νΈμ¶
    * μ¤μΌ€μΌμ„ μ›λ κ°’μΌλ΅ μ •κ·ν™” ($2^{80}$ β†’ $2^{40}$)
    * λ™μ‹μ— λ¨λ“λ¬μ¤ λ λ²¨ κ°μ† (Level 3 β†’ Level 2)
    * μ—°μ‚° μ •ν™•λ„ μ μ§€ (μƒλ€ μ¤μ°¨ $10^{-6}$ μμ¤€)

### 6.2. μ½”λ“ μμ‹
```go
// β μλ»λ κ³±μ… (Rescaling μ—†μ)
ctMul, _ := evaluator.MulRelinNew(ct1, ct2)
// λ³µνΈν™” μ‹ κ°’μ΄ 2^40 λ°° μ¦ν­λ¨!

// β… μ¬λ°”λ¥Έ κ³±μ… (λ λ²¨ λ§μ¶”κΈ° + Rescaling)
// 1. λ λ²¨ λ§μ¶”κΈ°
minLevel := ct1.Level()
if ct2.Level() < minLevel {
    minLevel = ct2.Level()
}
if ct1.Level() > minLevel {
    evaluator.DropLevel(ct1, ct1.Level()-minLevel)
}
if ct2.Level() > minLevel {
    evaluator.DropLevel(ct2, ct2.Level()-minLevel)
}

// 2. κ³±μ… μν–‰
ctMul, _ := evaluator.MulRelinNew(ct1, ct2)

// 3. Rescaling (μ¤μΌ€μΌ μ •κ·ν™”)
evaluator.Rescale(ctMul, ctMul)
// λ³µνΈν™” μ‹ μ •ν™•ν• κ°’ (μ¤μ°¨ < 0.1%)
```

### 6.3. ν‰λ¬Έ μΈμ½”λ”© μΌκ΄€μ„±
CKKSλ” λ³µμ†μ(complex128) λ²΅ν„°λ¥Ό λ‹¤λ£¨λ―€λ΅, **μ•”νΈν™”μ™€ λ³µνΈν™” μ‹ λ°μ΄ν„° νƒ€μ…μ„ μΌκ΄€λκ² μ‚¬μ©**ν•΄μ•Ό ν•©λ‹λ‹¤.

```go
// β μλ»λ μΈμ½”λ”© (νƒ€μ… λ¶μΌμΉ)
values := []float64{plaintext}  // float64 μ‚¬μ©
encoder.Encode(values, pt)

// β… μ¬λ°”λ¥Έ μΈμ½”λ”© (complex128 μ‚¬μ©)
values := make([]complex128, params.MaxSlots())
values[0] = complex(plaintext, 0)  // μ‹¤μλ¥Ό λ³µμ†μλ΅ λ³€ν™
encoder.Encode(values, pt)
```

### 6.4. μ—°μ‚°λ³„ Rescaling ν•„μ” μ—¬λ¶€
| μ—°μ‚° | Rescaling ν•„μ” | λ λ²¨ λ§μ¶”κΈ° ν•„μ” | μ΄μ  |
|------|---------------|----------------|------|
| **λ§μ…** (`Add`) | β λ¶ν•„μ” | β… **ν•„μ”** | μ¤μΌ€μΌ λ³€ν™” μ—†μ§€λ§ λ λ²¨μ€ λ§μ¶°μ•Ό ν•¨ |
| **κ³±μ…** (`MulRelin`) | β… **ν•„μ** | β… **ν•„μ** | μ¤μΌ€μΌμ΄ μ κ³±λκ³  λ λ²¨ λ¶μΌμΉ κ°€λ¥ |
| **νμ „** (`Rotate`) | β λ¶ν•„μ” | β λ¶ν•„μ” | μ¤μΌ€μΌ/λ λ²¨ λ³€ν™” μ—†μ |
| **μΌ¤λ ** (`Conjugate`) | β λ¶ν•„μ” | β λ¶ν•„μ” | μ¤μΌ€μΌ/λ λ²¨ λ³€ν™” μ—†μ |
| **ν‰λ¬Έ κ³±μ…** (`MultByConst`) | β… **κ¶μ¥** | β λ¶ν•„μ” | μ¤μΌ€μΌ μ¦κ°€ κ°€λ¥ |

### 6.5. λ λ²¨(Level) κ΄€λ¦¬
* **μ΄κΈ° λ λ²¨:** `params.MaxLevel()` (μ: Level 3, 4κ° λ¨λ“λ¬μ¤)
* **Rescaling ν›„:** λ λ²¨ 1 κ°μ† (Level 3 β†’ Level 2)
* **λ λ²¨ λ¶μΌμΉ λ¬Έμ :**
    * λ‘ μ•”νΈλ¬Έμ΄ λ‹¤λ¥Έ λ λ²¨μΌ λ• μ—°μ‚° λ¶κ°€
    * `evaluator.DropLevel(ct, dropCount)`λ΅ λ λ²¨μ„ λ‚®μ¶°μ„ λ§μ¶¤
    * **μ£Όμ:** λ λ²¨μ„ λ‚®μ¶”λ©΄ μ •ν™•λ„κ°€ κ°μ†ν•  μ μμ
* **λ λ²¨ κ³ κ°:**
    * λ λ²¨μ΄ 0μ΄ λλ©΄ λ” μ΄μƒ κ³±μ… λ¶κ°€
    * Bootstrapping λλ” λ” λ§μ€ λ¨λ“λ¬μ¤λ΅ νλΌλ―Έν„° μ¬μ„¤μ • ν•„μ”

### 6.6. λ””λ²„κΉ… ν
```javascript
// λ³µνΈν™” κ²°κ³Όκ°€ μ΄μƒν•  λ• ν™•μΈ μ‚¬ν•­

// 1. Rescaling λ„λ½ ν™•μΈ
console.log("Expected:", 1023.554 * 198.931); // 203616.62
console.log("Got:", decryptedValue);           // 2.03e+17 (μλ»λ¨)
// β†’ Rescaling λ„λ½!

// 2. λ λ²¨ λ¶μΌμΉ ν™•μΈ
console.log("Expected:", 1023.554 * 198.931); // 203616.62
console.log("Got:", decryptedValue);           // 33.60 (μλ»λ¨)
// β†’ λ λ²¨ λ§μ¶”κΈ° λ„λ½!

// 3. νƒ€μ… λ¶μΌμΉ ν™•μΈ
// float64 vs complex128 μΈμ½”λ”© λ¶μΌμΉ
// β†’ μ•”νΈν™”/λ³µνΈν™” λ¨λ‘ complex128 μ‚¬μ©

// μ¬λ°”λ¥Έ κ²°κ³Ό
console.log("Expected:", 1023.554 * 198.931); // 203616.62
console.log("Got:", decryptedValue);           // 203616.62 (μ •ν™•ν•¨)
```

### 6.7. μΌλ°μ μΈ μ¤μ°¨ ν¨ν„΄κ³Ό μ›μΈ
| μ¤μ°¨ ν¨ν„΄ | κ°€λ¥ν• μ›μΈ | ν•΄κ²° λ°©λ²• |
|----------|-----------|----------|
| κ²°κ³Όκ°€ **10^12~10^15λ°° νΌ** | Rescaling λ„λ½ | `evaluator.Rescale()` μ¶”κ°€ |
| κ²°κ³Όκ°€ **μμ²~μλ§λ°° μ‘μ** | λ λ²¨ λ¶μΌμΉ | `DropLevel()`λ΅ λ λ²¨ λ§μ¶”κΈ° |
| κ²°κ³Όκ°€ **λ¬΄μ‘μ„/μ΄μƒν•¨** | νƒ€μ… λ¶μΌμΉ | `complex128` μΌκ΄€ μ‚¬μ© |
| κ²°κ³Όκ°€ **μ•½κ°„ λ¶€μ •ν™•** (< 1%) | CKKS κ·Όμ‚¬ νΉμ„± | μ •μƒ (νλΌλ―Έν„° μ΅°μ •μΌλ΅ κ°μ„  κ°€λ¥) |
| **λ¨λ“  μ—°μ‚°μ—μ„ ν° μ¤μ°¨** | μ—­μ§λ ¬ν™” μ‹ λ λ²¨ κ³ μ • μ¤λ¥ | `new(rlwe.Ciphertext)` μ‚¬μ©ν•μ—¬ μλ™ λ³µμ› |

### 6.8. μ•”νΈλ¬Έ μ—­μ§λ ¬ν™” μ‹ μΉλ…μ  μ‹¤μ
**κ°€μ¥ ν”ν•κ³  μΉλ…μ μΈ μ¤λ¥:**

```go
// β μλ»λ λ°©λ²• - λ λ²¨μ„ MaxLevelλ΅ κ°•μ  μ§€μ •
ct := ckks.NewCiphertext(params, 1, params.MaxLevel())
ct.UnmarshalBinary(ctBytes)
// λ¬Έμ : μ‹¤μ  μ•”νΈλ¬Έμ΄ Level 2μΈλ° Level 3μΌλ΅ κ°•μ ν•λ©΄
// λ³µνΈν™” μ‹ μ™„μ „ν μ—‰λ±ν• κ°’μ΄ λ‚μ΄!

// β… μ¬λ°”λ¥Έ λ°©λ²• - UnmarshalBinaryκ°€ λ λ²¨ μλ™ λ³µμ›
ct := new(rlwe.Ciphertext)
ct.UnmarshalBinary(ctBytes)
// μ•”νΈλ¬Έμ— μ €μ¥λ μ‹¤μ  λ λ²¨μ΄ λ³µμ›λ¨
```

**μ¤‘μ”:** μ•”νΈλ¬Έμ„ μ—­μ§λ ¬ν™”ν•  λ• **μ λ€λ΅ λ λ²¨μ„ λ―Έλ¦¬ μ§€μ •ν•λ©΄ μ• λ©λ‹λ‹¤**. `UnmarshalBinary()`κ°€ μ§λ ¬ν™” μ‹ μ €μ¥λ λ©”νƒ€λ°μ΄ν„°(λ λ²¨, μ¤μΌ€μΌ λ“±)λ¥Ό μλ™μΌλ΅ λ³µμ›ν•λ„λ΅ ν•΄μ•Ό ν•©λ‹λ‹¤.