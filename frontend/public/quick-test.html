<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš¡ Quick Performance Test</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .result {
            background: #2a2a2a;
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .good { color: #00ff00; }
        .bad { color: #ff0000; }
        .warning { color: #ffaa00; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #00cc00;
        }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .metric {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>âš¡ Quick Performance Test</h1>
    <p>ê°„ë‹¨í•˜ê³  ë¹ ë¥¸ ì„±ëŠ¥ ì¸¡ì •</p>
    
    <button onclick="runTest()">â–¶ï¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
    <button onclick="location.reload()">ğŸ”„ ìƒˆë¡œê³ ì¹¨ (ìºì‹œ ì‚­ì œ)</button>
    
    <div id="result"></div>

    <script src="wasm_exec.js"></script>
    <script>
        async function runTest() {
            const output = document.getElementById('result');
            output.innerHTML = '<div class="result">â³ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...</div>';
            
            const results = {};
            const log = [];
            
            try {
                // 1. WASM ë¡œë”©
                log.push('ğŸ“¦ WASM ë¡œë”© ì‹œì‘...');
                const t0 = performance.now();
                
                const response = await fetch('main.wasm', { cache: 'no-cache' });
                const blob = await response.blob();
                const wasmSize = (blob.size / 1024 / 1024).toFixed(2);
                results.wasmSize = wasmSize;
                
                const t1 = performance.now();
                results.downloadTime = (t1 - t0).toFixed(2);
                log.push(`âœ… WASM ë‹¤ìš´ë¡œë“œ: ${results.downloadTime}ms (í¬ê¸°: ${wasmSize}MB)`);
                
                const arrayBuffer = await blob.arrayBuffer();
                const go = new Go();
                const result = await WebAssembly.instantiate(arrayBuffer, go.importObject);
                
                const t2 = performance.now();
                results.compileTime = (t2 - t1).toFixed(2);
                log.push(`âœ… WASM ì»´íŒŒì¼: ${results.compileTime}ms`);
                
                go.run(result.instance);
                
                // Go í•¨ìˆ˜ ë…¸ì¶œ ëŒ€ê¸°
                await new Promise((resolve) => {
                    const check = setInterval(() => {
                        if (window.Go && window.Go.fheKeygen) {
                            clearInterval(check);
                            resolve();
                        }
                    }, 10);
                });
                
                const t3 = performance.now();
                results.initTime = (t3 - t2).toFixed(2);
                log.push(`âœ… WASM ì´ˆê¸°í™”: ${results.initTime}ms`);
                log.push('');
                
                // 2. í‚¤ ìƒì„±
                log.push('ğŸ”‘ í‚¤ ìƒì„± ì‹œì‘...');
                const t4 = performance.now();
                const keys = await window.Go.fheKeygen();
                const t5 = performance.now();
                results.keygenTime = (t5 - t4).toFixed(2);
                log.push(`âœ… í‚¤ ìƒì„± ì™„ë£Œ: ${results.keygenTime}ms`);
                log.push('');
                
                // 3. RLK ìƒì„±
                log.push('ğŸ” RLK ìƒì„± ì‹œì‘...');
                const t6 = performance.now();
                const rlk = await window.Go.fheGenRelinearizationKey(keys.sk);
                const t7 = performance.now();
                results.rlkTime = (t7 - t6).toFixed(2);
                log.push(`âœ… RLK ìƒì„± ì™„ë£Œ: ${results.rlkTime}ms`);
                log.push('');
                
                // 4. 5ê°œ Feature ì•”í˜¸í™” (ê°œë³„ ì¸¡ì •)
                log.push('ğŸ” 5ê°œ Feature ì•”í˜¸í™” ì‹œì‘...');
                const features = [0.5, 0.6, 0.7, 0.8, 0.9];
                const encTimes = [];
                
                for (let i = 0; i < features.length; i++) {
                    const tStart = performance.now();
                    await window.Go.fheEncrypt(keys.pk, features[i]);
                    const tEnd = performance.now();
                    const time = (tEnd - tStart).toFixed(2);
                    encTimes.push(time);
                    log.push(`  Feature ${i+1}: ${time}ms`);
                }
                
                const totalEncTime = encTimes.reduce((a, b) => parseFloat(a) + parseFloat(b), 0).toFixed(2);
                const avgEncTime = (totalEncTime / features.length).toFixed(2);
                results.encTimes = encTimes;
                results.totalEncTime = totalEncTime;
                results.avgEncTime = avgEncTime;
                log.push(`âœ… ì´ ì•”í˜¸í™”: ${totalEncTime}ms (í‰ê· : ${avgEncTime}ms/feature)`);
                log.push('');
                
                // 5. íŒŒë¼ë¯¸í„° í™•ì¸
                const params = await window.Go.fheGetParamsInfo();
                results.params = params;
                log.push(`ğŸ“Š CKKS íŒŒë¼ë¯¸í„°:`);
                log.push(`  - LogN: ${params.LogN}`);
                log.push(`  - MaxLevel: ${params.MaxLevel}`);
                log.push(`  - MaxSlots: ${params.MaxSlots}`);
                
                // ê²°ê³¼ í‘œì‹œ
                displayResults(results, log);
                
            } catch (error) {
                output.innerHTML = `<div class="result"><span class="bad">âŒ ì—ëŸ¬: ${error.message}</span></div>`;
                console.error(error);
            }
        }
        
        function displayResults(results, log) {
            const output = document.getElementById('result');
            
            // ì„±ëŠ¥ í‰ê°€
            const avgEnc = parseFloat(results.avgEncTime);
            const totalEnc = parseFloat(results.totalEncTime);
            const keygen = parseFloat(results.keygenTime);
            
            let status = 'good';
            let statusText = 'âœ… ìš°ìˆ˜í•¨!';
            let recommendation = 'ëª¨ë“  ì„±ëŠ¥ ëª©í‘œ ë‹¬ì„±!';
            
            if (avgEnc > 30) {
                status = 'bad';
                statusText = 'âŒ ë§¤ìš° ëŠë¦¼!';
                recommendation = 'ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì™„ì „íˆ ì‚­ì œí•˜ê³  ì¬í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”!<br>Ctrl+Shift+Del â†’ "ì „ì²´ ê¸°ê°„" â†’ "ìºì‹œëœ ì´ë¯¸ì§€ ë° íŒŒì¼" ì²´í¬';
            } else if (avgEnc > 15) {
                status = 'warning';
                statusText = 'âš ï¸ ëŠë¦¼';
                recommendation = 'ë¸Œë¼ìš°ì €ë¥¼ ì¬ì‹œì‘í•˜ê±°ë‚˜ ì‹œí¬ë¦¿ ëª¨ë“œë¡œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.';
            }
            
            output.innerHTML = `
                <div class="result">
                    <h2 class="${status}">${statusText}</h2>
                    <div class="metric ${status}">í‰ê·  ì•”í˜¸í™”: ${results.avgEncTime}ms/feature</div>
                    <div class="metric ${status}">ì´ ì•”í˜¸í™” (5ê°œ): ${results.totalEncTime}ms</div>
                    <hr>
                    <p><strong>ëª©í‘œ:</strong> í‰ê·  6-10ms, ì´ 30-50ms</p>
                    <p class="${status}"><strong>${recommendation}</strong></p>
                </div>
                
                <div class="result">
                    <h3>ğŸ“Š ìƒì„¸ ë©”íŠ¸ë¦­</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid #444;">
                            <td><strong>í•­ëª©</strong></td>
                            <td><strong>ì‹œê°„</strong></td>
                            <td><strong>ìƒíƒœ</strong></td>
                        </tr>
                        <tr>
                            <td>WASM ë‹¤ìš´ë¡œë“œ</td>
                            <td>${results.downloadTime}ms</td>
                            <td class="${results.downloadTime < 100 ? 'good' : 'warning'}">
                                ${results.downloadTime < 100 ? 'âœ…' : 'âš ï¸'}
                            </td>
                        </tr>
                        <tr>
                            <td>WASM ì»´íŒŒì¼</td>
                            <td>${results.compileTime}ms</td>
                            <td class="${results.compileTime < 150 ? 'good' : 'warning'}">
                                ${results.compileTime < 150 ? 'âœ…' : 'âš ï¸'}
                            </td>
                        </tr>
                        <tr>
                            <td>WASM ì´ˆê¸°í™”</td>
                            <td>${results.initTime}ms</td>
                            <td class="${results.initTime < 100 ? 'good' : 'warning'}">
                                ${results.initTime < 100 ? 'âœ…' : 'âš ï¸'}
                            </td>
                        </tr>
                        <tr style="border-top: 2px solid #444;">
                            <td><strong>í‚¤ ìƒì„± (SK+PK)</strong></td>
                            <td><strong>${results.keygenTime}ms</strong></td>
                            <td class="${results.keygenTime < 50 ? 'good' : (results.keygenTime < 100 ? 'warning' : 'bad')}">
                                ${results.keygenTime < 50 ? 'âœ…' : (results.keygenTime < 100 ? 'âš ï¸' : 'âŒ')}
                            </td>
                        </tr>
                        <tr>
                            <td><strong>RLK ìƒì„±</strong></td>
                            <td><strong>${results.rlkTime}ms</strong></td>
                            <td class="${results.rlkTime < 20 ? 'good' : 'warning'}">
                                ${results.rlkTime < 20 ? 'âœ…' : 'âš ï¸'}
                            </td>
                        </tr>
                        <tr style="border-top: 2px solid #444;">
                            <td><strong>Feature 1 ì•”í˜¸í™”</strong></td>
                            <td><strong>${results.encTimes[0]}ms</strong></td>
                            <td class="${results.encTimes[0] < 15 ? 'good' : (results.encTimes[0] < 30 ? 'warning' : 'bad')}">
                                ${results.encTimes[0] < 15 ? 'âœ…' : (results.encTimes[0] < 30 ? 'âš ï¸' : 'âŒ')}
                            </td>
                        </tr>
                        <tr>
                            <td>Feature 2 ì•”í˜¸í™”</td>
                            <td>${results.encTimes[1]}ms</td>
                            <td class="${results.encTimes[1] < 15 ? 'good' : (results.encTimes[1] < 30 ? 'warning' : 'bad')}">
                                ${results.encTimes[1] < 15 ? 'âœ…' : (results.encTimes[1] < 30 ? 'âš ï¸' : 'âŒ')}
                            </td>
                        </tr>
                        <tr>
                            <td>Feature 3 ì•”í˜¸í™”</td>
                            <td>${results.encTimes[2]}ms</td>
                            <td class="${results.encTimes[2] < 15 ? 'good' : (results.encTimes[2] < 30 ? 'warning' : 'bad')}">
                                ${results.encTimes[2] < 15 ? 'âœ…' : (results.encTimes[2] < 30 ? 'âš ï¸' : 'âŒ')}
                            </td>
                        </tr>
                        <tr>
                            <td>Feature 4 ì•”í˜¸í™”</td>
                            <td>${results.encTimes[3]}ms</td>
                            <td class="${results.encTimes[3] < 15 ? 'good' : (results.encTimes[3] < 30 ? 'warning' : 'bad')}">
                                ${results.encTimes[3] < 15 ? 'âœ…' : (results.encTimes[3] < 30 ? 'âš ï¸' : 'âŒ')}
                            </td>
                        </tr>
                        <tr>
                            <td>Feature 5 ì•”í˜¸í™”</td>
                            <td>${results.encTimes[4]}ms</td>
                            <td class="${results.encTimes[4] < 15 ? 'good' : (results.encTimes[4] < 30 ? 'warning' : 'bad')}">
                                ${results.encTimes[4] < 15 ? 'âœ…' : (results.encTimes[4] < 30 ? 'âš ï¸' : 'âŒ')}
                            </td>
                        </tr>
                    </table>
                </div>
                
                <div class="result">
                    <h3>ğŸ“‹ ì „ì²´ ë¡œê·¸</h3>
                    <pre>${log.join('\n')}</pre>
                </div>
                
                <div class="result">
                    <h3>ğŸ” ì§„ë‹¨ ì •ë³´</h3>
                    <p><strong>WASM í¬ê¸°:</strong> ${results.wasmSize} MB ${results.wasmSize < 8 ? 'âœ…' : 'âš ï¸ (ë„ˆë¬´ í¼)'}</p>
                    <p><strong>LogN:</strong> ${results.params.LogN} ${results.params.LogN === 13 ? 'âœ…' : 'âŒ (13ì´ì–´ì•¼ í•¨)'}</p>
                    <p><strong>MaxLevel:</strong> ${results.params.MaxLevel} ${results.params.MaxLevel === 5 ? 'âœ…' : 'âŒ (5ì—¬ì•¼ í•¨)'}</p>
                    <p><strong>MaxSlots:</strong> ${results.params.MaxSlots}</p>
                    <hr>
                    <p><strong>ë¸Œë¼ìš°ì €:</strong> ${navigator.userAgent}</p>
                    <p><strong>í…ŒìŠ¤íŠ¸ ì‹œê°„:</strong> ${new Date().toLocaleString('ko-KR')}</p>
                </div>
            `;
        }
    </script>
</body>
</html>
